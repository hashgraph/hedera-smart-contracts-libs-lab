# Hedera Javascript SDK with Ethers.js

Example use of the Hedera JavaScript SDK along with the Ethers.js library.

The current version of the JavaScript SDK lacks some supporting features for smart contracts, this example shows how to combine elements of Ethers.js with the SDK to show how ethers.js may be used to:
* generate function calls using the contract's ABI
* interpret contract responses using the contract's ABI
* interpret event information using the contract's ABI

## Prerequisites

* Node v16.13.0
* Yarn v1.22.10

## Running the examples

```shell
yarn install
cd ../.env.sample ../.env
```

edit `.env` file and set your testnet operator id and key

### Compile solidity

Compiling with `ethers.js` is not possible, consequently, the contract has been compiled using `remix` and resulting `abi` and `bytecode` added to this project for convenience.

### Deploy contract to Hedera

this sample creates a file containing the contract's bytecode on the Hedera network, uses ethers.js to setup the constructor parameters and creates a contract instance on the Hedera network.

```shell
node deploy.js "hello hedera"
```

will output

```shell
constructor value:  Hello Hedera
new contract ID: 0.0.29549857
```

make a note of the contract id for subsequent calls below

### Get function call results

this sample queries the created contract in two different ways, in both cases, the ethers.js library is used to setup the contract call parameters

* first by issuing a query to a node (synchronous, no consensus)
* second, but issuing a transaction and obtaining a record which contains the result of the function call

```shell
node result.js contractId
```

replacing `contractId` with the value obtained in the previous step (e.g. 0.0.29549857 in our example)

will output

```shell
Using contract Id: 0.0.29547949
Result from query
[ 'Hello Hedera' ]
Result from transaction + record
[ 'Hello Hedera' ]
```

### Call contract function with parameters

this sample executes a function on the contract that affects its state, changing the stored `message` value to a new value. Again, we are using ethers.js to create the function parameters that are passed into the transaction.

```shell
node call.js contractId "hello again"
```

replacing `contractId` with the value obtained in the previous step (e.g. 0.0.29549857 in our example)

will output

```shell
Using contract Id:  0.0.29547949
Result from query
[ 'hello again' ]
```

### Retrieve events from records

this sample retrieves events generated by the smart contract. The `set_message` function emits an event which we will retrieve in this example.

The record for a smart contract transaction contains event data, the sample will show obtaining event information from a record.

```shell
node eventsFromRecord.js contractId
```

replacing `contractId` with the value obtained in the previous step (e.g. 0.0.29549857 in our example)

will output

```shell
Using contract Id:  0.0.29549857
events
from 0.0.11093
updated 4 times
```

the `from` should reflect your account id, and `updated n times` the number of times the `setMessage` contract function was called.

### Retrieve events from mirror node

this sample retrieves events generated by the smart contract via a mirror node. The `set_message` function emits an event which we will retrieve in this example.

```shell
node eventsFromMirror.js contractId
```

replacing `contractId` with the value obtained in the previous step (e.g. 0.0.29549857 in our example)

will output

```shell
from 0.0.11093
updated 1 times
from 0.0.11093
updated 2 times
from 0.0.11093
updated 3 times
from 0.0.11093
updated 4 times
```
